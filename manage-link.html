<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Providers Link</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="shortcut icon" href="Element/Icon.png">
    <link rel="stylesheet" href="https://unpkg.com/boxicons@latest/css/boxicons.min.css">
</head>
<body>

    <header class="header">
        <div class="menuBtnC">
            <i class='bx bx-menu'></i>
        </div>
        <div id="header" class="userInfoR">
            <!-- 头部内容将根据用户登录状态动态插入 -->
        </div>
    </header>

<!-- 侧边栏菜单 -->
<div class="sidebar" id="sidebar">
    <div class="sideBarTopCont">
        <h2>MENU</h2>
        <button class="close-btn" id="closeSidebar">
            <i class='bx bx-x'></i>
        </button>
    </div>
    <a href="gamelog.html"><i class='bx bxs-wallet-alt'></i>Game Log & Resit</a>
    <a href="tipsgame.html"><i class='bx bxs-game' ></i>Tips Game</a>
    <a href="providers-link.html"><i class='bx bx-link-alt'></i>Providers Link</a>
    <a href="index.html"><i class='bx bxs-cog'></i>Settings</a>
    <a href="report.html"><i class='bx bxs-error-alt' ></i>Report Problem</a>
    <div id="avatarMenu">
        <a href="girls.html"><i class='bx bxs-image'></i>Girls Avatar</a>
        <a href="manage-user.html"><i class='bx bxs-user-circle'></i>Manage User</a>
        <a href="manage-link.html"><i class='bx bx-unlink'></i>Manage Link</a>
    </div>
</div>

<div class="manage-link-full-cover">

<table id="data-table" class="manage-link-container">
    <thead>
        <tr>
            <th>PROVIDERS</th>
            <th>DOWNLOAD</th>
            <th>WEB</th>
            <th>KIOSK</th>
            <th>ACTION</th> <!-- 新增操作列 -->
        </tr>
    </thead>
    <tbody>
        <!-- 数据行将在这里插入 -->
    </tbody>
</table>

</div>

<script>
        const productsData = []; // 用于存储产品数据

    async function loadData() {
        const response = await fetch('https://script.google.com/macros/s/AKfycbzKCf0GseaUqR6mwg6nyivBPJiwWv-_mj26Uq3MPlKsklIW3rtxsIWkxG2H4o2b5h_YRA/exec'); // 替换为您的 Google Apps Script URL
        if (!response.ok) {
            console.error("HTTP错误", response.status);
            return; // 如果请求失败，停止执行
        }
        const products = await response.json();
        productsData.push(...products); // 将产品数据保存到数组中
        displayData(products);
    }

    function displayData(products) {
        const tableBody = document.getElementById('data-table').querySelector('tbody');
        products.forEach((product, index) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${product.name || '未知产品'}</td>
                <td contenteditable="false" class="editable" data-index="${index}">${product.download || '无链接'}</td>
                <td contenteditable="false" class="editable" data-index="${index}">${product.web || '无链接'}</td>
                <td contenteditable="false" class="editable" data-index="${index}">${product.kiosk || '无链接'}</td>
                <td>
                    <span class="edit-button" onclick="editRow(${index})"><i class='bx bxs-edit'></i></span>
                    <span class="save-button" onclick="saveRow(${index})"><i class='bx bxs-save'></i></span>
                </td>
            `;
            tableBody.appendChild(tr);
        });
    }

    function editRow(index) {
        const cells = document.querySelectorAll(`.editable[data-index="${index}"]`);
        cells.forEach(cell => {
            cell.contentEditable = true; // 允许编辑
            cell.focus(); // 聚焦到第一个可编辑单元格
        });
    }

    async function saveRow(index) {
        const cells = document.querySelectorAll(`.editable[data-index="${index}"]`);
        const updatedData = Array.from(cells).map(cell => cell.innerText); // 获取更新后的数据
        
        // 在这里调用 Google Apps Script 的 API 更新 Google Sheets 中的数据
        const response = await fetch('https://script.google.com/macros/s/AKfycbzKCf0GseaUqR6mwg6nyivBPJiwWv-_mj26Uq3MPlKsklIW3rtxsIWkxG2H4o2b5h_YRA/exec', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                index: index,
                data: updatedData
            })
        });
        
        if (response.ok) {
            cells.forEach(cell => {
                cell.contentEditable = false; // 禁止编辑
            });
            alert("保存成功！"); // 显示保存成功的消息
        } else {
            alert("保存失败，请重试。");
        }
    }

    window.onload = function() {
    loadData();
    checkLoginStatus();
};
</script>


<footer class="copyRight">
    <p>Copyrght © 2024 WWW.CS-TOOLS.ONLINE All Rights Reserved.</p>
</footer>

<script>
    // 检查用户登录状态
    function checkLoginStatus() {
    const username = localStorage.getItem('username');
    const headerDiv = document.getElementById('header');

    if (!username) {
        // 如果未登录，跳转到 login.html
        window.location.href = 'login.html';
    } else {
        // 如果已登录，显示欢迎信息和登出按钮
        const welcomeMessage = `Welcome, ${username}`;
        headerDiv.innerHTML = `
            <div class="welcome-message">${welcomeMessage}</div>
            <button class="logout-btn" onclick="logout()"><i class='bx bx-log-out-circle'></i></button>
        `;
    }
}

// 退出登录功能
function logout() {
    // 清除登录信息
    localStorage.removeItem('username');
    localStorage.removeItem('fullName');
    localStorage.removeItem('phoneNumber');
    localStorage.removeItem('option1');
    localStorage.removeItem('number2');
    localStorage.removeItem('option2');

    // 跳转回登录页面
    window.location.href = 'login.html';
}

document.addEventListener("DOMContentLoaded", function() {
    const currentPath = window.location.pathname;

    // 检查路径是否以 .html 结尾
    if (currentPath.endsWith('.html')) {
        const newPath = currentPath.slice(0, -5);
        history.replaceState(null, '', newPath);
    }
});

document.addEventListener("DOMContentLoaded", function() {
const loggedInUser = localStorage.getItem("username"); // 假设存储了用户名

// 如果用户不是 admin，重定向到 index.html
if (loggedInUser !== "admin") {
    window.location.href = "index.html"; // 重定向到 index.html
} else {
    // 如果是 admin，显示 avatarMenu
    document.getElementById("avatarMenu").style.display = "block";
}
});

// 控制侧边栏的显示和隐藏
const menuBtn = document.querySelector('.menuBtnC');
const sidebar = document.getElementById('sidebar');
const closeSidebarBtn = document.getElementById('closeSidebar');

menuBtn.addEventListener('click', () => {
    sidebar.classList.toggle('active'); // 点击按钮切换侧边栏显示状态
});

closeSidebarBtn.addEventListener('click', () => {
    sidebar.classList.remove('active'); // 点击关闭按钮隐藏侧边栏
});
</script>

</body>
</html>
